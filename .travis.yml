language: java
jdk:
  - oraclejdk8

sudo: enabled
dist: trusty

notifications:
  email: true

script:
  - export JARNAME="variantQC"
  - export VERSION=""
  - mvn -Djar.finalName=$JARNAME -Dversion=$VERSION clean verify

after_success:
  - git describe --tags $(git rev-list --tags --max-count=1)
  - git for-each-ref refs/tags --sort=-taggerdate --format='%(refname)' --count=1
  - echo "$TRAVIS_TAG and $TRAVIS_BUILD_NUMBER"
  - export JARFILE="$JARNAME-v$VERSION.jar"
  - echo "$JARNAME and $JARFILE"
  - cp target/$JARNAME-$VERSION.jar target/$JARFILE
  - echo "$TRAVIS_TAG and $TRAVIS_BUILD_NUMBER"
  - git tag v$TRAVIS_BUILD_NUMBER -a -m "Travis build $TRAVIS_BUILD_NUMBER pushed a tag."
  #- git push origin --tags
  - git push origin v$TRAVIS_BUILD_NUMBER

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: $TRAVIS_CI_OAUTH_TOKEN
  file: #target/travis-build-test-1.0-SNAPSHOT.jar
    - target/$JARFILE
    - target/$JARNAME-$VERSION.jar
  on:
    repo: melissayan/travis_ci_test
    #branch: travis-branch
    all_branches: true
    tags: false

after_deploy:
  - echo "$TRAVIS_TAG and $TRAVIS_BUILD_NUMBER"

branches:
  except:
    - /^*-v[0-9]/